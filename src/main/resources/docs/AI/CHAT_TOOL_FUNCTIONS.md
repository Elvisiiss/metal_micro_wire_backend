# AI工具调用功能文档

## 概述

金属微细线材综合检测平台的AI助手具备强大的工具调用能力，可以实时获取和分析系统数据，为用户提供准确的信息查询和专业的分析建议。

当前系统共提供**11个工具函数**，涵盖设备管理、线材检测、质量分析、统计报告和系统功能等多个方面。

## 工具调用能力

### 1. 设备管理工具

#### get_device_list - 获取设备列表
- **功能**：查询设备列表，支持分页和状态筛选
- **参数**：
  - `page`: 页码（可选，默认1）
  - `size`: 每页大小（可选，默认10）
  - `status`: 设备状态筛选（可选，ON/OFF）
- **使用场景**：
  - "显示所有设备"
  - "查看在线设备"
  - "设备状态统计"

#### get_device_info - 获取设备详情
- **功能**：根据设备ID获取设备详细信息
- **参数**：
  - `deviceId`: 设备ID（必需）
- **使用场景**：
  - "设备XXX的详细信息"
  - "检查设备状态"

### 2. 线材检测数据工具

#### get_wire_material_list - 获取线材列表
- **功能**：查询金属微丝检测数据，支持多种筛选条件
- **参数**：
  - `page`: 页码（可选，默认1）
  - `size`: 每页大小（可选，默认10）
  - `batchNumber`: 批次号筛选（可选）
  - `manufacturer`: 生产商筛选（可选）
  - `scenarioCode`: 应用场景编号筛选（可选）
- **使用场景**：
  - "显示最新的检测数据"
  - "查看某个生产商的产品"
  - "特定场景的线材数据"

#### get_wire_material_info - 获取线材详情
- **功能**：根据批次号获取线材详细检测信息
- **参数**：
  - `batchNumber`: 批次号（必需）
- **使用场景**：
  - "批次XXX的详细信息"
  - "查看质量参数"

### 3. 质量分析工具

#### analyze_quality_issues - 质量问题溯源分析
- **功能**：执行质量问题溯源分析，分析指定条件下的质量问题
- **参数**：
  - `dimension`: 分析维度（必需）
    - `manufacturer`: 生产商
    - `responsiblePerson`: 负责人
    - `processType`: 工艺类型
    - `productionMachine`: 生产机器
    - `scenarioCode`: 应用场景
  - `dimensionValue`: 维度值（必需）
  - `startTime`: 开始时间（可选，格式：yyyy-MM-dd HH:mm:ss）
  - `endTime`: 结束时间（可选，格式：yyyy-MM-dd HH:mm:ss）
- **使用场景**：
  - "分析某个生产商的质量问题"
  - "某个时间段的质量分析"
  - "工艺类型质量对比"

#### get_quality_issues - 获取质量问题列表
- **功能**：获取质量问题列表，识别不合格的线材批次
- **参数**：
  - `dimension`: 查询维度（可选）
  - `dimensionValue`: 维度值（可选）
- **使用场景**：
  - "显示所有质量问题"
  - "不合格产品统计"

#### get_manufacturer_ranking - 生产商质量排名
- **功能**：获取生产商质量排名，分析各生产商的质量表现
- **参数**：
  - `startTime`: 开始时间（可选）
  - `endTime`: 结束时间（可选）
  - `scenarioCode`: 应用场景编号（可选）
- **使用场景**：
  - "生产商质量排名"
  - "供应商评估"
  - "质量表现对比"

### 4. 统计分析工具

#### get_overall_statistics - 系统总体统计
- **功能**：获取系统总体统计数据，包括总检测数量、合格率、设备数量等
- **参数**：无
- **使用场景**：
  - "系统整体情况"
  - "总体数据概览"
  - "平台运营状况"

#### get_yearly_statistics - 年度统计
- **功能**：获取最近12个月的年度检测数据统计
- **参数**：无
- **使用场景**：
  - "年度趋势分析"
  - "月度数据对比"
  - "历史数据查看"

#### get_scenario_statistics - 场景统计
- **功能**：根据时间范围获取应用场景统计数据
- **参数**：
  - `how`: 时间范围（必需）
    - `this_month`: 本月
    - `last_month`: 上月
    - `this_year`: 今年
    - `last_year`: 去年
    - `all`: 全部
- **使用场景**：
  - "本月场景统计"
  - "场景数据对比"
  - "应用场景分析"

### 5. 系统工具

#### get_current_time - 获取当前时间
- **功能**：获取当前系统时间和日期信息
- **参数**：
  - `format`: 时间格式类型（可选，默认datetime）
    - `datetime`: 完整日期时间
    - `date`: 仅日期
    - `time`: 仅时间
    - `timestamp`: 时间戳
  - `timezone`: 时区（可选，默认Asia/Shanghai）
- **使用场景**：
  - "现在几点了？"
  - "今天是几号？"
  - "当前时间戳是多少？"
  - "现在是星期几？"

## 使用示例

### 示例对话1：设备状态查询
**用户**：显示所有在线设备
**AI助手**：我来为您查询所有在线设备的信息。
*[调用 get_device_list 工具，参数：status="ON"]*
根据查询结果，当前有X台设备在线...

### 示例对话2：质量问题分析
**用户**：分析一下华为公司的产品质量情况
**AI助手**：我来为您分析华为公司的产品质量情况。
*[调用 analyze_quality_issues 工具，参数：dimension="manufacturer", dimensionValue="华为"]*
根据分析结果，华为公司的产品质量表现如下...

### 示例对话3：数据统计查询
**用户**：给我看看系统的整体运营数据
**AI助手**：我来为您获取系统的整体运营数据。
*[调用 get_overall_statistics 工具]*
根据统计数据，系统总体运营情况如下...

### 示例对话4：时间查询
**用户**：现在几点了？今天是星期几？
**AI助手**：我来为您查询当前的时间信息。
*[调用 get_current_time 工具，参数：format="datetime"]*
根据系统时间，现在是2024年1月15日 14:30:25，今天是星期一...

## 技术实现

### 工具调用流程
1. **用户输入**：用户发送消息到聊天接口
2. **AI理解**：DeepSeek模型理解用户意图
3. **工具选择**：AI根据优化后的系统提示词选择合适的工具函数
4. **参数解析**：解析工具调用的参数
5. **工具执行**：调用后端业务服务获取数据
6. **结果处理**：处理工具调用结果
7. **响应生成**：AI基于工具结果生成回答

### 多步骤分析策略
优化后的AI助手遵循以下多步骤分析流程：
1. **时间确定**：如涉及"今天"、"本月"等时间概念，先调用get_current_time获取准确时间
2. **数据收集**：根据需求调用相应的数据获取工具（设备、线材、质量等）
3. **深度分析**：使用分析工具进行质量溯源、排名对比等
4. **统计汇总**：调用统计工具提供整体数据概览

### 常见任务的工具组合
- **今日检测数据分析**：get_current_time → get_device_list → get_wire_material_list → get_overall_statistics
- **质量问题调查**：get_quality_issues → analyze_quality_issues → get_manufacturer_ranking
- **生产商评估**：get_manufacturer_ranking → analyze_quality_issues → get_wire_material_list
- **设备状态检查**：get_device_list → get_device_info → get_overall_statistics
- **时间范围分析**：get_current_time → get_scenario_statistics → get_yearly_statistics

### 权限控制
- 所有工具调用都会验证用户身份
- 不同用户类型（普通用户/Root用户）有相应的数据访问权限
- 工具调用结果会根据用户权限进行过滤

### 错误处理
- 工具调用失败时会返回友好的错误提示
- 参数错误时会提供正确的参数格式说明
- 网络异常时会建议用户重试

## 注意事项

1. **数据实时性**：工具调用获取的是实时数据，确保信息的准确性
2. **性能考虑**：大量数据查询可能需要一定时间，请耐心等待
3. **参数格式**：时间参数需要严格按照格式要求输入
4. **权限限制**：某些敏感数据可能需要特定权限才能访问

## 未来扩展

计划增加更多工具调用功能：
- 设备控制工具（启停设备）
- 质量预测工具（基于机器学习）
- 报告生成工具（自动生成分析报告）
- 告警管理工具（质量异常告警）
- 数据导出工具（导出分析结果）
- 系统监控工具（系统状态检查）